================================================================================
Virtual Blackwell v6.0 训练速度测试（精度分离缓存优化）
================================================================================
设备: cpu

创建Claude4模型...
模型参数: 35,862,532

应用Virtual Blackwell...
[虚拟Blackwell] 模式=训练, FP4=启用, BOH量化=启用
[OK] 替换层: encoder.image_proj (1024 -> 256)
[虚拟Blackwell] 模式=训练, FP4=启用, BOH量化=启用
[OK] 替换层: encoder.audio_proj (512 -> 256)
[虚拟Blackwell] 模式=训练, FP4=启用, BOH量化=启用
[OK] 替换层: blocks.0.attn.W_q (256 -> 256)
[虚拟Blackwell] 模式=训练, FP4=启用, BOH量化=启用
[OK] 替换层: blocks.0.attn.W_k (256 -> 256)
[虚拟Blackwell] 模式=训练, FP4=启用, BOH量化=启用
[OK] 替换层: blocks.0.attn.W_v (256 -> 256)
[虚拟Blackwell] 模式=训练, FP4=启用, BOH量化=启用
[OK] 替换层: blocks.0.attn.W_o (256 -> 256)
[虚拟Blackwell] 模式=训练, FP4=启用, BOH量化=启用
[OK] 替换层: blocks.0.ffn.experts.0.0 (256 -> 1024)
[虚拟Blackwell] 模式=训练, FP4=启用, BOH量化=启用
[OK] 替换层: blocks.0.ffn.experts.0.2 (1024 -> 256)
[虚拟Blackwell] 模式=训练, FP4=启用, BOH量化=启用
[OK] 替换层: blocks.0.ffn.experts.1.0 (256 -> 1024)
[虚拟Blackwell] 模式=训练, FP4=启用, BOH量化=启用
[OK] 替换层: blocks.0.ffn.experts.1.2 (1024 -> 256)
[虚拟Blackwell] 模式=训练, FP4=启用, BOH量化=启用
[OK] 替换层: blocks.0.ffn.experts.2.0 (256 -> 1024)
[虚拟Blackwell] 模式=训练, FP4=启用, BOH量化=启用
[OK] 替换层: blocks.0.ffn.experts.2.2 (1024 -> 256)
[虚拟Blackwell] 模式=训练, FP4=启用, BOH量化=启用
[OK] 替换层: blocks.0.ffn.experts.3.0 (256 -> 1024)
[虚拟Blackwell] 模式=训练, FP4=启用, BOH量化=启用
[OK] 替换层: blocks.0.ffn.experts.3.2 (1024 -> 256)
[虚拟Blackwell] 模式=训练, FP4=启用, BOH量化=启用
[OK] 替换层: blocks.0.ffn.gate (256 -> 4)
[虚拟Blackwell] 模式=训练, FP4=启用, BOH量化=启用
[OK] 替换层: blocks.1.attn.W_q (256 -> 256)
[虚拟Blackwell] 模式=训练, FP4=启用, BOH量化=启用
[OK] 替换层: blocks.1.attn.W_k (256 -> 256)
[虚拟Blackwell] 模式=训练, FP4=启用, BOH量化=启用
[OK] 替换层: blocks.1.attn.W_v (256 -> 256)
[虚拟Blackwell] 模式=训练, FP4=启用, BOH量化=启用
[OK] 替换层: blocks.1.attn.W_o (256 -> 256)
[虚拟Blackwell] 模式=训练, FP4=启用, BOH量化=启用
[OK] 替换层: blocks.1.ffn.experts.0.0 (256 -> 1024)
[虚拟Blackwell] 模式=训练, FP4=启用, BOH量化=启用
[OK] 替换层: blocks.1.ffn.experts.0.2 (1024 -> 256)
[虚拟Blackwell] 模式=训练, FP4=启用, BOH量化=启用
[OK] 替换层: blocks.1.ffn.experts.1.0 (256 -> 1024)
[虚拟Blackwell] 模式=训练, FP4=启用, BOH量化=启用
[OK] 替换层: blocks.1.ffn.experts.1.2 (1024 -> 256)
[虚拟Blackwell] 模式=训练, FP4=启用, BOH量化=启用
[OK] 替换层: blocks.1.ffn.experts.2.0 (256 -> 1024)
[虚拟Blackwell] 模式=训练, FP4=启用, BOH量化=启用
[OK] 替换层: blocks.1.ffn.experts.2.2 (1024 -> 256)
[虚拟Blackwell] 模式=训练, FP4=启用, BOH量化=启用
[OK] 替换层: blocks.1.ffn.experts.3.0 (256 -> 1024)
[虚拟Blackwell] 模式=训练, FP4=启用, BOH量化=启用
[OK] 替换层: blocks.1.ffn.experts.3.2 (1024 -> 256)
[虚拟Blackwell] 模式=训练, FP4=启用, BOH量化=启用
[OK] 替换层: blocks.1.ffn.gate (256 -> 4)
[虚拟Blackwell] 模式=训练, FP4=启用, BOH量化=启用
[OK] 替换层: blocks.1.reflection.connectivity_analyzer.connectivity_proj (256 -> 1)
[虚拟Blackwell] 模式=训练, FP4=启用, BOH量化=启用
[OK] 替换层: blocks.1.reflection.shortest_path_reflection.path_attn.out_proj (256 -> 256)
[虚拟Blackwell] 模式=训练, FP4=启用, BOH量化=启用
[OK] 替换层: blocks.1.reflection.mirror_complexity.mirror_projs.0 (256 -> 256)
[虚拟Blackwell] 模式=训练, FP4=启用, BOH量化=启用
[OK] 替换层: blocks.1.reflection.mirror_complexity.mirror_projs.1 (256 -> 256)
[虚拟Blackwell] 模式=训练, FP4=启用, BOH量化=启用
[OK] 替换层: blocks.1.reflection.mirror_complexity.mirror_projs.2 (256 -> 256)
[虚拟Blackwell] 模式=训练, FP4=启用, BOH量化=启用
[OK] 替换层: blocks.1.reflection.mirror_complexity.complexity_scorer.0 (768 -> 256)
[虚拟Blackwell] 模式=训练, FP4=启用, BOH量化=启用
[OK] 替换层: blocks.1.reflection.mirror_complexity.complexity_scorer.2 (256 -> 1)
[虚拟Blackwell] 模式=训练, FP4=启用, BOH量化=启用
[OK] 替换层: blocks.1.reflection.fusion.0 (768 -> 256)
[虚拟Blackwell] 模式=训练, FP4=启用, BOH量化=启用
[OK] 替换层: blocks.1.reflection.fusion.4 (256 -> 256)
[虚拟Blackwell] 模式=训练, FP4=启用, BOH量化=启用
[OK] 替换层: blocks.1.reflection.feedback_gate.0 (256 -> 256)
[虚拟Blackwell] 模式=训练, FP4=启用, BOH量化=启用
[OK] 替换层: blocks.2.attn.W_q (256 -> 256)
[虚拟Blackwell] 模式=训练, FP4=启用, BOH量化=启用
[OK] 替换层: blocks.2.attn.W_k (256 -> 256)
[虚拟Blackwell] 模式=训练, FP4=启用, BOH量化=启用
[OK] 替换层: blocks.2.attn.W_v (256 -> 256)
[虚拟Blackwell] 模式=训练, FP4=启用, BOH量化=启用
[OK] 替换层: blocks.2.attn.W_o (256 -> 256)
[虚拟Blackwell] 模式=训练, FP4=启用, BOH量化=启用
[OK] 替换层: blocks.2.ffn.experts.0.0 (256 -> 1024)
[虚拟Blackwell] 模式=训练, FP4=启用, BOH量化=启用
[OK] 替换层: blocks.2.ffn.experts.0.2 (1024 -> 256)
[虚拟Blackwell] 模式=训练, FP4=启用, BOH量化=启用
[OK] 替换层: blocks.2.ffn.experts.1.0 (256 -> 1024)
[虚拟Blackwell] 模式=训练, FP4=启用, BOH量化=启用
[OK] 替换层: blocks.2.ffn.experts.1.2 (1024 -> 256)
[虚拟Blackwell] 模式=训练, FP4=启用, BOH量化=启用
[OK] 替换层: blocks.2.ffn.experts.2.0 (256 -> 1024)
[虚拟Blackwell] 模式=训练, FP4=启用, BOH量化=启用
[OK] 替换层: blocks.2.ffn.experts.2.2 (1024 -> 256)
[虚拟Blackwell] 模式=训练, FP4=启用, BOH量化=启用
[OK] 替换层: blocks.2.ffn.experts.3.0 (256 -> 1024)
[虚拟Blackwell] 模式=训练, FP4=启用, BOH量化=启用
[OK] 替换层: blocks.2.ffn.experts.3.2 (1024 -> 256)
[虚拟Blackwell] 模式=训练, FP4=启用, BOH量化=启用
[OK] 替换层: blocks.2.ffn.gate (256 -> 4)
[虚拟Blackwell] 模式=训练, FP4=启用, BOH量化=启用
[OK] 替换层: blocks.2.reflection.connectivity_analyzer.connectivity_proj (256 -> 1)
[虚拟Blackwell] 模式=训练, FP4=启用, BOH量化=启用
[OK] 替换层: blocks.2.reflection.shortest_path_reflection.path_attn.out_proj (256 -> 256)
[虚拟Blackwell] 模式=训练, FP4=启用, BOH量化=启用
[OK] 替换层: blocks.2.reflection.mirror_complexity.mirror_projs.0 (256 -> 256)
[虚拟Blackwell] 模式=训练, FP4=启用, BOH量化=启用
[OK] 替换层: blocks.2.reflection.mirror_complexity.mirror_projs.1 (256 -> 256)
[虚拟Blackwell] 模式=训练, FP4=启用, BOH量化=启用
[OK] 替换层: blocks.2.reflection.mirror_complexity.mirror_projs.2 (256 -> 256)
[虚拟Blackwell] 模式=训练, FP4=启用, BOH量化=启用
[OK] 替换层: blocks.2.reflection.mirror_complexity.complexity_scorer.0 (768 -> 256)
[虚拟Blackwell] 模式=训练, FP4=启用, BOH量化=启用
[OK] 替换层: blocks.2.reflection.mirror_complexity.complexity_scorer.2 (256 -> 1)
[虚拟Blackwell] 模式=训练, FP4=启用, BOH量化=启用
[OK] 替换层: blocks.2.reflection.fusion.0 (768 -> 256)
[虚拟Blackwell] 模式=训练, FP4=启用, BOH量化=启用
[OK] 替换层: blocks.2.reflection.fusion.4 (256 -> 256)
[虚拟Blackwell] 模式=训练, FP4=启用, BOH量化=启用
[OK] 替换层: blocks.2.reflection.feedback_gate.0 (256 -> 256)
[虚拟Blackwell] 模式=训练, FP4=启用, BOH量化=启用
[OK] 替换层: output_head (256 -> 50000)
虚拟Blackwell显卡: 62 张

配置: batch_size=8, seq_len=128, batches=20
================================================================================

开始训练测试...
--------------------------------------------------------------------------------
Batch  5/20 | Loss: 10.9786 | Time: 2.72s | Avg(last 5): 3.56s
Batch 10/20 | Loss: 10.9877 | Time: 2.72s | Avg(last 5): 2.71s
Batch 15/20 | Loss: 10.9826 | Time: 2.83s | Avg(last 5): 2.75s
Batch 20/20 | Loss: 10.9624 | Time: 2.80s | Avg(last 5): 2.79s
--------------------------------------------------------------------------------

================================================================================
性能统计
================================================================================
总时间: 59.06s
总批次: 20
平均batch时间: 2.95s
首批时间: 6.41s (包含精度分离)
后续批次平均: 2.77s (使用缓存)
吞吐量: 0.34 batch/s

推算单epoch时间 (100 batch): 280.7s (4.7分钟)

================================================================================
Virtual Blackwell 统计
================================================================================
总计算次数: 1120
缓存命中: 1064 (95.0%)
缓存刷新: 0
精度分离次数: 56 (首次 + 刷新)

前3层详细统计:
--------------------------------------------------------------------------------

[encoder.image_proj]
  总计算: 0
  缓存命中: 0
  缓存刷新: 0
  缓存命中率: 0.0%

[encoder.audio_proj]
  总计算: 0
  缓存命中: 0
  缓存刷新: 0
  缓存命中率: 0.0%

[blocks.0.attn.W_q]
  总计算: 20
  缓存命中: 19
  缓存刷新: 0
  缓存命中率: 95.0%

================================================================================
测试完成！
================================================================================
