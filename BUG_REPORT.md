# APT-Transformer å®Œæ•´Bugæ‰«ææŠ¥å‘Š
**ç”Ÿæˆæ—¶é—´**: 2025-12-04
**æ‰«æèŒƒå›´**: apt_model/ å’Œ tests/ ç›®å½•
**å‘ç°Bugæ€»æ•°**: 27ä¸ª

---

## ğŸ“Š æ€»è§ˆç»Ÿè®¡

### ä¸»ä»£ç åº“ (apt_model/)
| ä¸¥é‡ç¨‹åº¦ | æ•°é‡ | ä¸»è¦å½±å“ |
|---------|------|---------|
| **CRITICAL** | 3 | å¯¼è‡´å´©æºƒæˆ–åŠŸèƒ½å¤±æ•ˆ |
| **HIGH** | 5 | æ•°æ®ä¸¢å¤±ã€èµ„æºæ³„æ¼ |
| **MEDIUM** | 4 | å¥å£®æ€§ã€å¯ç»´æŠ¤æ€§ |
| **LOW** | 3 | ä»£ç è´¨é‡ä¼˜åŒ– |

### æµ‹è¯•ç›®å½• (tests/)
| ä¸¥é‡ç¨‹åº¦ | æ•°é‡ | ä¸»è¦å½±å“ |
|---------|------|---------|
| **HIGH** | 3 | æµ‹è¯•æ— æ³•è¿è¡Œ |
| **MEDIUM** | 6 | ç¯å¢ƒä¾èµ–é—®é¢˜ |
| **LOW** | 3 | ä»£ç è§„èŒƒé—®é¢˜ |

---

## ğŸ”´ CRITICAL ä¸¥é‡Bug (3ä¸ª)

### 1. Gradio 6.x `every` å‚æ•°ä¸å…¼å®¹
**æ–‡ä»¶**: `apt_model/webui/create_training_launcher.py:239`
**é—®é¢˜**: `log_output.change(every=1)` åœ¨Gradio 6.xä¸­ä¸æ”¯æŒ
**å½±å“**: æ—¥å¿—åˆ·æ–°å¤±æ•ˆ
**ä¿®å¤**: ç§»é™¤`every`å‚æ•°æˆ–ä½¿ç”¨è½®è¯¢æ›¿ä»£æ–¹æ¡ˆ

### 2. subprocess stdout NoneTypeé”™è¯¯
**æ–‡ä»¶**: `apt_model/webui/app.py:985`, `create_training_launcher.py:167`
**é—®é¢˜**: ç›´æ¥è¿­ä»£stdoutå¯èƒ½ä¸ºNoneçš„å¯¹è±¡
**å½±å“**: è®­ç»ƒæ—¥å¿—è¯»å–å´©æºƒ
**ä¿®å¤**: æ·»åŠ Noneæ£€æŸ¥å’Œå¼‚å¸¸å¤„ç†

### 3. tokenizer.pad_token_id æœªéªŒè¯
**æ–‡ä»¶**: `apt_model/training/trainer.py:254, 259, 402`
**é—®é¢˜**: pad_token_idå¯èƒ½ä¸ºNone
**å½±å“**: è®­ç»ƒå´©æºƒ
**ä¿®å¤**: æ·»åŠ é»˜è®¤å€¼fallback

---

## ğŸŸ  HIGH é«˜ä¼˜å…ˆçº§Bug (5ä¸ª)

### 4. å‚æ•°ä¼ é€’é€»è¾‘é—®é¢˜
**æ–‡ä»¶**: `apt_model/cli/commands.py:210-220`
**é—®é¢˜**: `data_path=None`ä½†ä¾èµ–`custom_texts`
**å½±å“**: æ•°æ®åŠ è½½å¤±è´¥æ—¶æ— æç¤º
**ä¿®å¤**: æ·»åŠ æ•°æ®éªŒè¯

### 5. å®ˆæŠ¤çº¿ç¨‹èµ„æºæ³„æ¼
**æ–‡ä»¶**: `apt_model/webui/create_training_launcher.py:166-171`
**é—®é¢˜**: daemonçº¿ç¨‹æ— è¶…æ—¶å’Œæ¸…ç†æœºåˆ¶
**å½±å“**: èµ„æºæ³„æ¼ã€åƒµå°¸è¿›ç¨‹
**ä¿®å¤**: æ·»åŠ é€€å‡ºæ¡ä»¶å’Œå¼‚å¸¸å¤„ç†

### 6. tokenizerå±æ€§è®¿é—®æœªæ£€æŸ¥
**æ–‡ä»¶**: `apt_model/training/trainer.py:275`
**é—®é¢˜**: `tokenizer.vocab_size`å¯èƒ½ä¸å­˜åœ¨
**å½±å“**: AttributeError
**ä¿®å¤**: ä½¿ç”¨`getattr()`å¸¦é»˜è®¤å€¼

### 7. Imageæ–‡ä»¶å¥æŸ„æœªå…³é—­
**æ–‡ä»¶**: `apt_model/training/data_loading.py:222`
**é—®é¢˜**: `Image.open()`æœªä½¿ç”¨ä¸Šä¸‹æ–‡ç®¡ç†å™¨
**å½±å“**: æ–‡ä»¶å¥æŸ„æ³„æ¼
**ä¿®å¤**: ä½¿ç”¨`with`è¯­å¥

### 8-12. æµ‹è¯•æ–‡ä»¶è·¯å¾„é—®é¢˜ (3ä¸ªé«˜ä¼˜å…ˆçº§)
- `tests/test_bert_tokenizer.py:10` - ç¡¬ç¼–ç ç›¸å¯¹è·¯å¾„
- `tests/test_compression_plugin.py:12-17` - importlibè·¯å¾„ä¸å®Œæ•´
- `tests/test_terminator_scenario.py:14` - **ç¼ºå¤±æ¨¡å—ä¾èµ–**

---

## ğŸŸ¡ MEDIUM ä¸­ç­‰ä¼˜å…ˆçº§Bug (10ä¸ª)

### å¼‚å¸¸å¤„ç†
- `apt_model/webui/create_training_launcher.py:179-181` - å¼‚å¸¸æ•è·è¿‡äºå®½æ³›
- `apt_model/training/data_loading.py:92, 181, 184` - ä½¿ç”¨assertåšè¿è¡Œæ—¶éªŒè¯

### æ–‡ä»¶æ“ä½œ
- `apt_model/webui/app.py:793` - æ–‡ä»¶å†™å…¥ç¼ºå°‘å¼‚å¸¸å¤„ç†
- `apt_model/training/trainer.py:46-47` - ç›¸å¯¹è·¯å¾„é£é™©

### æµ‹è¯•æ–‡ä»¶è·¯å¾„ (6ä¸ª)
- å¤šä¸ªæµ‹è¯•æ–‡ä»¶ä½¿ç”¨ç¡¬ç¼–ç ç»å¯¹è·¯å¾„ `/home/user/APT-Transformer`
- å»ºè®®ç»Ÿä¸€ä½¿ç”¨ç›¸å¯¹è·¯å¾„ï¼š`Path(__file__).parent.parent`

---

## ğŸŸ¢ LOW ä½ä¼˜å…ˆçº§Bug (6ä¸ª)

- æœªä½¿ç”¨çš„å¯¼å…¥
- é­”æ•°ç¡¬ç¼–ç ï¼ˆpin_memoryï¼‰
- è°ƒè¯•ä»£ç æœªæ¸…ç†
- ç¡¬ç¼–ç æç¤ºè¯
- è·¯å¾„å¤„ç†æ–¹å¼ä¸ç»Ÿä¸€
- ä»£ç è§„èŒƒé—®é¢˜

---

## ğŸ“‹ ä¿®å¤ä¼˜å…ˆçº§å»ºè®®

### ç¬¬1é˜¶æ®µ (ç«‹å³ä¿®å¤ - 1-2å‘¨)
âœ… **å·²ä¿®å¤**:
- README.md æ–‡æ¡£é“¾æ¥404
- WebUIè¯­è¨€åˆ‡æ¢åŠŸèƒ½ï¼ˆå·²ç§»é™¤ï¼‰

ğŸ”´ **éœ€ä¿®å¤** (CRITICAL + HIGH):
1. trainer.pyçš„tokenizeræ£€æŸ¥
2. WebUIçš„subprocesså¤„ç†
3. å®ˆæŠ¤çº¿ç¨‹èµ„æºç®¡ç†
4. Imageæ–‡ä»¶å¥æŸ„
5. æµ‹è¯•æ–‡ä»¶çš„å…³é”®è·¯å¾„é—®é¢˜

### ç¬¬2é˜¶æ®µ (çŸ­æœŸè®¡åˆ’ - 2-4å‘¨)
ğŸŸ¡ MEDIUMçº§åˆ«çš„10ä¸ªbug

### ç¬¬3é˜¶æ®µ (é•¿æœŸä¼˜åŒ– - 1æœˆä»¥ä¸Š)
ğŸŸ¢ LOWçº§åˆ«çš„6ä¸ªbug

---

## ğŸ“ ç›¸å…³æ–‡ä»¶æ¸…å•

### éœ€è¦ä¿®å¤çš„ä¸»è¦æ–‡ä»¶
- `apt_model/training/trainer.py`
- `apt_model/webui/app.py`
- `apt_model/webui/create_training_launcher.py`
- `apt_model/training/data_loading.py`
- `apt_model/cli/commands.py`

### éœ€è¦ä¿®å¤çš„æµ‹è¯•æ–‡ä»¶
- `tests/test_bert_tokenizer.py`
- `tests/test_compression_plugin.py`
- `tests/test_terminator_scenario.py`
- 6ä¸ªä¸­ä¼˜å…ˆçº§è·¯å¾„é—®é¢˜çš„æµ‹è¯•æ–‡ä»¶

---

**ç”Ÿæˆå·¥å…·**: Claude Code Deep Scan
**æ‰«ææ–¹æ³•**: é™æ€åˆ†æ + æ¨¡å¼åŒ¹é… + ä»£ç å®¡æŸ¥
**å¯ä¿¡åº¦**: é«˜ï¼ˆåŸºäºå®é™…ä»£ç æ£€æŸ¥ï¼‰
